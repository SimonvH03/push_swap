Index once, update on rotation and pushing

free stacks after malloc fail (or other init err)